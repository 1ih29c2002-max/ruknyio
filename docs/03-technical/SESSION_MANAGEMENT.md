# ูุธุงู ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ูุงูุฃูุงู ๐

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ุงููุดุทุฉ ูุชุญุณูู ุงูุฃูุงู ูู ุงูุชุทุจูู.

## ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ุงููุดุทุฉ
- โ ุชุณุฌูู ูุนูููุงุช ุชูุตูููุฉ ุนู ูู ุฌูุณุฉ (ูุชุตูุญุ ูุธุงู ุงูุชุดุบููุ IPุ ุงููููุน)
- โ ุนุฑุถ ุฌููุน ุงูุฃุฌูุฒุฉ ุงููุดุทุฉ ุงููุณุฌู ุฏุฎูููุง
- โ ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุฌูุงุฒ ูุนูู (ุฅููุงุก ุงูุฌูุณุฉ ููุฑุงู)
- โ ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุฌููุน ุงูุฃุฌูุฒุฉ ุงูุฃุฎุฑู
- โ ุชุญุฏูุซ ุขุฎุฑ ูุดุงุท ุชููุงุฆูุงู ุนูุฏ ูู ุทูุจ
- โ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฌูุณุงุช ุชููุงุฆูุงู ุจุนุฏ 30 ููู

### 2. ุงูุชุญูู ูู ุงูุฌูุณุงุช
- ูู ุทูุจ API ูุชู ุงูุชุญูู ูู:
  - ูุฌูุฏ ุงูุฌูุณุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ุฃู ุงูุฌูุณุฉ ุชุฎุต ุงููุณุชุฎุฏู ุงูุตุญูุญ
  - ุฃู ุงูุฌูุณุฉ ูู ุชูุชูู ุตูุงุญูุชูุง
  - ุชุญุฏูุซ ุขุฎุฑ ูุดุงุท ููุฌูุณุฉ

### 3. ุตูุญุฉ ุงูุชูุงุก ุงูุฌูุณุฉ
- ุตูุญุฉ ูุฎุตุตุฉ ูุฅุนูุงู ุงููุณุชุฎุฏู ุจุงูุชูุงุก ุฌูุณุชู
- ุชูุถูุญ ุงูุฃุณุจุงุจ ุงููุญุชููุฉ ูุงูุชูุงุก ุงูุฌูุณุฉ
- ุฅุฑุดุงุฏุงุช ูุงุถุญุฉ ูููุณุชุฎุฏู

### 4. ุชุณุฌูู ุงูุฎุฑูุฌ ุงููุญุณูู
- ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ ูุชู:
  - ุญุฐู ุงูุฌูุณุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ุฅููุงุก ุงููุตูู ููุฑุงู
  - ุชูุธูู ุงูุชููู ูู ุงููุชุตูุญ

## ููููุฉ ุงูุนูู

### ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
```
1. ุงููุณุชุฎุฏู ูุณุฌู ุงูุฏุฎูู
2. ูุชู ุชูููุฏ JWT token
3. ูุชู ุชุญููู User Agent ููุญุตูู ุนูู ูุนูููุงุช ุงูุฌูุงุฒ
4. ูุชู ุญูุธ ูุนูููุงุช ุงูุฌูุณุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
   - userId
   - token (JWT)
   - deviceName, deviceType, browser, os
   - ipAddress
   - expiresAt (30 days from now)
   - lastActivity
```

### ุนูุฏ ูู ุทูุจ API
```
1. ุงุณุชุฎุฑุงุฌ JWT token ูู Authorization header
2. ุงูุชุญูู ูู ุตุญุฉ ุงูุชููู
3. ุงูุจุญุซ ุนู ุงูุฌูุณุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ุงูุชุญูู ูู:
   - ุฃู ุงูุฌูุณุฉ ููุฌูุฏุฉ
   - ุฃู userId ูุทุงุจู
   - ุฃู ุงูุฌูุณุฉ ูู ุชูุชูู
5. ุชุญุฏูุซ lastActivity
6. ุงูุณูุงุญ ุจุงููุตูู
```

### ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุฌูุงุฒ
```
1. ุงููุณุชุฎุฏู ูุถุบุท "ุชุณุฌูู ุงูุฎุฑูุฌ" ุนูู ุฌูุงุฒ ูุนูู
2. ูุชู ุญุฐู ุงูุฌูุณุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุนูุฏ ุงูุทูุจ ุงูุชุงูู ูู ุฐูู ุงูุฌูุงุฒ:
   - ูู ูุฌุฏ ุงูุฌูุณุฉ
   - ุณูุญุตู ุนูู 401 Unauthorized
   - ุณูุชู ุชูุฌููู ุฅูู /session-expired
```

## API Endpoints

### Sessions Management
- `GET /user/sessions` - ุงูุญุตูู ุนูู ุฌููุน ุงูุฌูุณุงุช ุงููุดุทุฉ
- `DELETE /user/sessions/:id` - ุญุฐู ุฌูุณุฉ ูุนููุฉ
- `DELETE /user/sessions` - ุญุฐู ุฌููุน ุงูุฌูุณุงุช ุงูุฃุฎุฑู
- `POST /auth/logout` - ุชุณุฌูู ุงูุฎุฑูุฌ (ุญุฐู ุงูุฌูุณุฉ ุงูุญุงููุฉ)

## ุงูุตูุญุงุช ุงูุฌุฏูุฏุฉ

### /session-expired
ุตูุญุฉ ุชุธูุฑ ุนูุฏูุง:
- ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุงูุฌูุงุฒ ูู ุฌูุงุฒ ุขุฎุฑ
- ุงูุชูุช ุตูุงุญูุฉ ุงูุฌูุณุฉ
- ุชู ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู sessions
```prisma
model Session {
  id           String   @id @default(uuid())
  userId       String
  token        String   @unique
  deviceName   String?
  deviceType   String?
  browser      String?
  os           String?
  ipAddress    String?
  location     String?
  lastActivity DateTime @default(now())
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
```

## ุงูุฃูุงู

### ุงูุญูุงูุฉ ุงููุทุจูุฉ:
1. **Token Validation**: ุงูุชุญูู ูู ุตุญุฉ JWT
2. **Session Validation**: ุงูุชุญูู ูู ูุฌูุฏ ุงูุฌูุณุฉ ูู DB
3. **User Matching**: ุงูุชุฃูุฏ ุฃู ุงูุฌูุณุฉ ุชุฎุต ุงููุณุชุฎุฏู
4. **Expiration Check**: ุงูุชุญูู ูู ุนุฏู ุงูุชูุงุก ุงูุตูุงุญูุฉ
5. **Activity Tracking**: ุชุชุจุน ุขุฎุฑ ูุดุงุท
6. **Automatic Cleanup**: ุญุฐู ุงูุฌูุณุงุช ุงูููุชููุฉ

### ููุงุฆุฏ ุงูุฃูุงู:
- โ ูุง ูููู ุงุณุชุฎุฏุงู ุงูุชููู ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
- โ ุฅููุงููุฉ ุชุณุฌูู ุงูุฎุฑูุฌ ุนู ุจูุนุฏ
- โ ุฑุคูุฉ ุฌููุน ุงูุฃุฌูุฒุฉ ุงููุดุทุฉ
- โ ุงูุชุดุงู ุงูุฏุฎูู ุบูุฑ ุงููุตุฑุญ ุจู
- โ ุงูุญุฏ ูู ุงููุตูู ุจุนุฏ 30 ููู

## ุงูุงุณุชุฎุฏุงู ูู Frontend

### ุนุฑุถ ุงูุฃุฌูุฒุฉ ุงููุดุทุฉ
```tsx
const sessions = await fetch('/user/sessions');
// ุนุฑุถ ูุงุฆูุฉ ุงูุฃุฌูุฒุฉ ูุน ุฅููุงููุฉ ุงูุญุฐู
```

### ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุฌูุงุฒ
```tsx
await fetch(`/user/sessions/${sessionId}`, { method: 'DELETE' });
// ุงูุฌูุณุฉ ุชูุญุฐู ููุฑุงูุ ุงููุณุชุฎุฏู ุนูู ุฐูู ุงูุฌูุงุฒ ุณููุทุฑุฏ
```

### ูุนุงูุฌุฉ ุงูุชูุงุก ุงูุฌูุณุฉ
```tsx
// ูู AuthContext
if (res.status === 401) {
  removeToken();
  router.push('/session-expired');
}
```

## ุงูููุชุจุงุช ุงููุณุชุฎุฏูุฉ
- `ua-parser-js` - ูุชุญููู ูุนูููุงุช User Agent
- `@types/ua-parser-js` - ููุฃููุงุน ูู TypeScript

## ุงูุฎุทูุงุช ุงููุงุฏูุฉ ุงูููุชุฑุญุฉ
- [ ] ุฅุถุงูุฉ Geolocation ููููุงูุน ุงูุฌุบุฑุงููุฉ
- [ ] ุชูุจููุงุช ุจุงูุจุฑูุฏ ุนูุฏ ุชุณุฌูู ุฏุฎูู ูู ุฌูุงุฒ ุฌุฏูุฏ
- [ ] ุณุฌู ุชุงุฑูุฎ ุงูุฌูุณุงุช (ุงูุฌูุณุงุช ุงูููุชููุฉ)
- [ ] ุฅุญุตุงุฆูุงุช ุญูู ุงูุฃุฌูุฒุฉ ุงููุณุชุฎุฏูุฉ
- [ ] ุชุญุฏูุฏ ุญุฏ ุฃูุตู ููุฌูุณุงุช ุงููุดุทุฉ
