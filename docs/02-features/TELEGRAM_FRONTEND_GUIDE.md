# ๐ฑ Telegram Integration - ุฏููู Frontend

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุงุฌูุฉ ูุณุชุฎุฏู ูุงููุฉ ูุฑุจุท ุญุณุงุจุงุช ุงููุณุชุฎุฏููู ูุน Telegram ูุงุณุชูุจุงู ุงูุฅุดุนุงุฑุงุช ุงูุฃูููุฉ.

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ

### 1. **Types** - `apps/web/types/telegram.ts`
ูุญุชูู ุนูู ุฌููุน ุงูุฃููุงุน ูุงูู Interfaces ุงููุณุชุฎุฏูุฉ:
- `TelegramConnectionStatus` - ุญุงูุฉ ุงูุงุชุตุงู
- `TelegramSession` - ุจูุงูุงุช ุฌูุณุฉ ุงูุชุญูู
- `TelegramConnectionState` - ุญุงูุงุช UI (idle, generating, waiting, connected, error)
- Response Types ูุฌููุน API endpoints

### 2. **API Client** - `apps/web/lib/telegram-api.ts`
ููุชุจุฉ ููุชูุงุตู ูุน Backend:

**ุงูุฏูุงู ุงููุชุงุญุฉ:**
```typescript
// ุชูููุฏ ููุฏ ุงูุชุญูู
generateTelegramCode(): Promise<TelegramGenerateCodeResponse>

// ุงูุญุตูู ุนูู ุญุงูุฉ ุงูุงุชุตุงู
getTelegramStatus(): Promise<TelegramStatusResponse>

// ูุตู ุงูุญุณุงุจ
disconnectTelegram(): Promise<TelegramDisconnectResponse>

// ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ
sendTestMessage(): Promise<TelegramTestResponse>

// ุงูุชุญูู ุงูุฏูุฑู (Polling)
pollTelegramStatus(
  intervalMs: number,
  onStatusChange: Function,
  maxAttempts: number
): () => void

// ุฏูุงู ูุณุงุนุฏุฉ
copyToClipboard(text: string): Promise<void>
openTelegramDeepLink(deepLink: string): void
formatTimeRemaining(expiresAt: Date): string
```

### 3. **ุงููููู ุงูุฑุฆูุณู** - `apps/web/components/auth/telegram-integration.tsx`
ูููู React ูุงูู ูุน ุฌููุน ุงูุญุงูุงุช:

**ุงูููุฒุงุช:**
- โ ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู
- โ ุญุงูุงุช ูุชุนุฏุฏุฉ (ุบูุฑ ูุชุตูุ ุชูููุฏ ุงูููุฏุ ุงูุชุธุงุฑุ ูุชุตูุ ุฎุทุฃ)
- โ ุนุฏุงุฏ ุชูุงุฒูู ูุงูุชูุงุก ุตูุงุญูุฉ ุงูููุฏ
- โ ุงูุชุญูู ุงูุฏูุฑู ุงูุชููุงุฆู ูู ุญุงูุฉ ุงูุงุชุตุงู
- โ ูุณุฎ ุงูููุฏ ุจููุฑุฉ ูุงุญุฏุฉ
- โ ูุชุญ Telegram ูุจุงุดุฑุฉ ูู ุงููุชุตูุญ
- โ ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ
- โ ูุตู ุงูุญุณุงุจ ูุน ุชุฃููุฏ

**ุงูุญุงูุงุช ุงููุฏุนููุฉ:**
1. **Idle** - ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ (ุบูุฑ ูุชุตู)
2. **Generating** - ูููุฏ ููุฏ ุงูุชุญูู
3. **Waiting** - ุงูุชุธุงุฑ ุงููุณุชุฎุฏู ููุฑุจุท
4. **Connected** - ูุชุตู ุจูุฌุงุญ
5. **Error** - ุฎุทุฃ ูู ุงูุนูููุฉ
6. **Disconnecting** - ูุตู ุงูุงุชุตุงู

### 4. **ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช** - `apps/web/app/settings/security/page.tsx`
ุตูุญุฉ ูุงููุฉ ููุฅุนุฏุงุฏุงุช ุงูุฃูููุฉ:
- ูุณู ุงูุฅุดุนุงุฑุงุช ุงูุฃูููุฉ (ูุญุชูู ุนูู ูููู Telegram)
- ูุณู ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ (ูุฑูุจุงู)
- ูุณู ุงูุฃุฌูุฒุฉ ุงูููุซููุฉ (ูุฑูุจุงู)

---

## ๐ ุงูุงุณุชุฎุฏุงู

### 1. ุงุณุชุฎุฏุงู ุงููููู ุงูุฃุณุงุณู

```tsx
import { TelegramIntegration } from '@/components/auth/telegram-integration';

function MyPage() {
  const handleSuccess = () => {
    console.log('ุชู ุฑุจุท Telegram ุจูุฌุงุญ!');
  };

  const handleError = (error: string) => {
    console.error('ุฎุทุฃ:', error);
  };

  return (
    <TelegramIntegration
      onSuccess={handleSuccess}
      onError={handleError}
      className="max-w-md"
    />
  );
}
```

### 2. ุงุณุชุฎุฏุงู API Client ูุจุงุดุฑุฉ

```tsx
import { 
  generateTelegramCode, 
  getTelegramStatus,
  sendTestMessage 
} from '@/lib/telegram-api';

async function myFunction() {
  // ุชูููุฏ ููุฏ
  const session = await generateTelegramCode();
  console.log('ุงูููุฏ:', session.session.code);

  // ุงูุญุตูู ุนูู ุงูุญุงูุฉ
  const status = await getTelegramStatus();
  console.log('ูุชุตูุ', status.status.connected);

  // ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ
  await sendTestMessage();
}
```

### 3. ุงูุชุญูู ุงูุฏูุฑู

```tsx
import { pollTelegramStatus } from '@/lib/telegram-api';

const stopPolling = pollTelegramStatus(
  3000, // ูู 3 ุซูุงูู
  (status) => {
    if (status.status.connected) {
      console.log('ุชู ุงูุฑุจุท!');
      stopPolling(); // ุฅููุงู ุงูุชุญูู
    }
  },
  60 // 60 ูุญุงููุฉ ูุญุฏ ุฃูุตู
);
```

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ

### 1. Environment Variables

ุฃุถู ูู `.env.local`:

```env
# Backend API URL
NEXT_PUBLIC_API_URL=http://localhost:3001
```

### 2. Authentication Token

ุงูููุชุจุฉ ุชุณุชุฎุฏู `localStorage.getItem('access_token')` ููุญุตูู ุนูู JWT Token.

ุชุฃูุฏ ูู ุญูุธ ุงูู token ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู:

```typescript
// ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
localStorage.setItem('access_token', response.accessToken);
```

---

## ๐จ ุงูุชุตููู

ุงููููู ูุณุชุฎุฏู ููุชุจุฉ **shadcn/ui** ููุญุชุงุฌ:

### ุงูููููุงุช ุงููุทููุจุฉ:
```bash
npx shadcn-ui@latest add button
npx shadcn-ui@latest add card
npx shadcn-ui@latest add alert
npx shadcn-ui@latest add badge
npx shadcn-ui@latest add separator
```

### ุงูุฃููููุงุช:
```bash
npm install lucide-react
```

---

## ๐ ุชุฏูู ุงูุนูู (Workflow)

### ุณููุงุฑูู ุงูุฑุจุท ุงููุงุฌุญ:

```
1. ุงููุณุชุฎุฏู ูุถุบุท "ุฑุจุท ุญุณุงุจ Telegram"
   โ
2. State: generating โ ูููุฏ ููุฏ ุงูุชุญูู ูู Backend
   โ
3. State: waiting โ ูุนุฑุถ ุงูููุฏ + ุงูุชุนูููุงุช + Deep Link
   โ
4. ุงููุณุชุฎุฏู ููุชุญ Telegram ููุฑุณู /start CODE
   โ
5. Polling ูุชุญูู ูู 3 ุซูุงูู ูู ุญุงูุฉ ุงูุงุชุตุงู
   โ
6. ุนูุฏ ูุฌุงุญ ุงูุฑุจุท โ State: connected
   โ
7. ูุนุฑุถ ูุนูููุงุช ุงูุญุณุงุจ + ุฒุฑ "ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ"
```

### ุณููุงุฑูู ุงูุชูุงุก ุตูุงุญูุฉ ุงูููุฏ:

```
1. State: waiting
   โ
2. ุนุฏุงุฏ ุชูุงุฒูู ูุนูู ูู ุซุงููุฉ
   โ
3. ุนูุฏ ุงููุตูู ูู 0 โ State: error
   โ
4. ูุนุฑุถ "ุงูุชูุช ุตูุงุญูุฉ ุงูููุฏ"
   โ
5. ุฒุฑ "ุฅุนุงุฏุฉ ุงููุญุงููุฉ" โ ุงูุนูุฏุฉ ูู State: idle
```

---

## ๐ฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### 1. ุญุงูุฉ ุบูุฑ ูุชุตู (Idle)
- ุจุทุงูุฉ ุชุนุฑูููุฉ ุจุงูููุฒุงุช
- ูุงุฆูุฉ ุจููุงุฆุฏ ุงูุฑุจุท ูุน Telegram
- ุฒุฑ "ุฑุจุท ุญุณุงุจ Telegram"

### 2. ุญุงูุฉ ุงูุงูุชุธุงุฑ (Waiting)
- ููุฏ ุงูุชุญูู ุจุฎุท ูุจูุฑ ููุงุถุญ
- ุนุฏุงุฏ ุชูุงุฒูู ููููุช ุงููุชุจูู
- ุชุนูููุงุช ุฎุทูุฉ ุจุฎุทูุฉ
- ุฒุฑ "ูุณุฎ ุงูููุฏ"
- ุฒุฑ "ูุชุญ Telegram" (deep link)
- ุฒุฑ "ุฅูุบุงุก"

### 3. ุญุงูุฉ ูุชุตู (Connected)
- ุดุงุฑุฉ ุฎุถุฑุงุก "ูุชุตู"
- ูุนูููุงุช ุงูุญุณุงุจ (ุงุณู ุงููุณุชุฎุฏูุ ุงูุงุณูุ ุชุงุฑูุฎ ุงูุฑุจุท)
- ุฒุฑ "ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ"
- ุฒุฑ "ูุตู ุงูุญุณุงุจ"

### 4. ุญุงูุฉ ุงูุฎุทุฃ (Error)
- ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
- ุฒุฑ "ุฅุนุงุฏุฉ ุงููุญุงููุฉ"

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุณุฑูุน

```bash
# ุชุดุบูู Frontend
cd apps/web
npm run dev

# ูุชุญ ุงููุชุตูุญ ุนูู
http://localhost:3000/settings/security
```

### 2. ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

โ **ุงุฎุชุจุงุฑ ุงูุฑุจุท ุงููุงุฌุญ:**
1. ุงุถุบุท "ุฑุจุท ุญุณุงุจ Telegram"
2. ุงูุณุฎ ุงูููุฏ
3. ุงูุชุญ Telegram
4. ุฃุฑุณู `/start CODE` ููุจูุช
5. ุชุญูู ูู ุชุบููุฑ ุงูุญุงูุฉ ุชููุงุฆูุงู

โ **ุงุฎุชุจุงุฑ ุงูุชูุงุก ุงูุตูุงุญูุฉ:**
1. ุงุจุฏุฃ ุนูููุฉ ุงูุฑุจุท
2. ุงูุชุธุฑ 5 ุฏูุงุฆู ุจุฏูู ุฅุฏุฎุงู ุงูููุฏ
3. ุชุญูู ูู ุธููุฑ ุฑุณุงูุฉ "ุงูุชูุช ุตูุงุญูุฉ ุงูููุฏ"

โ **ุงุฎุชุจุงุฑ ุงูุฑุณุงูุฉ ุงูุชุฌุฑูุจูุฉ:**
1. ุจุนุฏ ุงูุฑุจุท ุงููุงุฌุญ
2. ุงุถุบุท "ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ"
3. ุชุญูู ูู ุงุณุชูุงู ุงูุฑุณุงูุฉ ูู Telegram

โ **ุงุฎุชุจุงุฑ ูุตู ุงูุญุณุงุจ:**
1. ุงุถุบุท "ูุตู ุงูุญุณุงุจ"
2. ุฃูุฏ ุงูุฅุฌุฑุงุก
3. ุชุญูู ูู ุนูุฏุฉ ุงูุญุงูุฉ ูู idle

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: "ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู"
**ุงูุญู:**
- ุชุญูู ูู ุฃู Backend ูุนูู ุนูู ุงููููุฐ ุงูุตุญูุญ
- ุชุญูู ูู `NEXT_PUBLIC_API_URL` ูู `.env.local`
- ุชุญูู ูู ูุฌูุฏ CORS Headers ูู Backend

### ูุดููุฉ: "Unauthorized"
**ุงูุญู:**
- ุชุญูู ูู ูุฌูุฏ JWT Token ูู localStorage
- ุชุญูู ูู ุตูุงุญูุฉ ุงูู token (ูู ููุชู)
- ุชุณุฌูู ุงูุฏุฎูู ูุฌุฏุฏุงู

### ูุดููุฉ: ุงูู Polling ูุง ูุนูู
**ุงูุญู:**
- ุงูุชุญ Developer Console ูุชุญูู ูู ุงูุฃุฎุทุงุก
- ุชุญูู ูู ุฃู `/telegram/status` endpoint ูุนูู
- ุชุญูู ูู ุนุฏู ุญุธุฑ ุงููุชุตูุญ ููู polling

### ูุดููุฉ: Deep Link ูุง ููุชุญ Telegram
**ุงูุญู:**
- ุชุฃูุฏ ุฃู Telegram ูุซุจุช ุนูู ุงูุฌูุงุฒ
- ุฌุฑุจ ูุณุฎ ุงูููุฏ ูุฏููุงู
- ุงุณุชุฎุฏู Telegram Web ุฅุฐุง ูู ูุนูู ุงูุชุทุจูู

---

## ๐ ุงูุฃุฏุงุก

### Optimization Tips:

1. **Polling Interval:**
   - ุญุงููุงู: 3 ุซูุงูู
   - ูููู ุชููููู ูู 2 ุซุงููุฉ ููุงุณุชุฌุงุจุฉ ุงูุฃุณุฑุน
   - ูููู ุฒูุงุฏุชู ูู 5 ุซูุงูู ูุชูููู ุงูุญูู

2. **Max Attempts:**
   - ุญุงููุงู: 60 ูุญุงููุฉ (3 ุฏูุงุฆู ูุน interval 3s)
   - ููุงุณุจ ููุนุธู ุงูุญุงูุงุช

3. **Cleanup:**
   - ุฌููุน useEffect ูุฏููุง cleanup functions
   - ูุง ุชุณุฑูุจุงุช ููุฐุงูุฑุฉ (memory leaks)

---

## ๐ ุงูุฃูุงู

### Best Practices ุงูููุชุจุนุฉ:

โ **JWT Authentication:**
- ุฌููุน ุงูุทูุจุงุช ูุญููุฉ ุจู JWT Token
- Token ููุฑุณู ูู Authorization Header

โ **Session Expiry:**
- ููุฏ ุงูุชุญูู ููุชูู ุจุนุฏ 5 ุฏูุงุฆู
- ุนุฏุงุฏ ุชูุงุฒูู ูุญุฐุฑ ุงููุณุชุฎุฏู

โ **Confirmation Dialog:**
- ุชุฃููุฏ ูุจู ูุตู ุงูุญุณุงุจ
- ููุน ุงูุฅุฌุฑุงุกุงุช ุบูุฑ ุงูููุตูุฏุฉ

โ **Error Handling:**
- ุฌููุน API calls ุฏุงุฎู try-catch
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู

---

## ๐ฏ ุงูุฎุทูุงุช ุงููุงุฏูุฉ

### ุงููุฑุญูุฉ ุงูุชุงููุฉ:

1. โ **ุฅุถุงูุฉ QR Code:**
   - ุนุฑุถ QR Code ุจุฏูุงู ูู ุงูููุฏ ุงููุตู ููุท
   - ุงุณุชุฎุฏุงู ููุชุจุฉ `qrcode.react`

2. โ **ุชุญุณูู ุงูุชุตููู:**
   - ุฅุถุงูุฉ ุฑุณูู ูุชุญุฑูุฉ (animations)
   - ุชุญุณูู responsive design

3. โ **ุฅุถุงูุฉ Notifications:**
   - Toast notifications ูููุฌุงุญ/ุงููุดู
   - ุงุณุชุฎุฏุงู ููุชุจุฉ `sonner` ุฃู `react-hot-toast`

4. โ **ุชุนุฏุฏ ุงููุบุงุช (i18n):**
   - ุฏุนู ุงูุฅูุฌููุฒูุฉ ุจุฌุงูุจ ุงูุนุฑุจูุฉ
   - ุงุณุชุฎุฏุงู `next-intl`

---

## ๐ ููุงุญุธุงุช ูููุฉ

โ๏ธ **ูุจู ุงูุงุณุชุฎุฏุงู ูู Production:**

1. ุชุบููุฑ `NEXT_PUBLIC_API_URL` ููู Production URL
2. ุฅุถุงูุฉ Rate Limiting ููู API calls
3. ุฅุถุงูุฉ Analytics ูุชุชุจุน ุงุณุชุฎุฏุงู ุงูููุฒุฉ
4. ุงุฎุชุจุงุฑ ุนูู ูุฎุชูู ุงูุฃุฌูุฒุฉ ูุงููุชุตูุญุงุช
5. ุฅุถุงูุฉ Error Tracking (ูุซู Sentry)

---

## ๐ ุงูููุงุฑุฏ

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [shadcn/ui Documentation](https://ui.shadcn.com/)
- [Next.js App Router](https://nextjs.org/docs/app)
- [React Hooks](https://react.dev/reference/react)

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุฑุงุฌุน ูุณู "ุงุณุชูุดุงู ุงูุฃุฎุทุงุก" ุฃุนูุงู
2. ุชุญูู ูู Console ููุฃุฎุทุงุก
3. ุฑุงุฌุน Network Tab ูู Developer Tools
4. ุชุญูู ูู ุฃู Backend ูุนูู ุจุดูู ุตุญูุญ

---

**ุชู ุฅูุดุงุคู ูู:** 2024/12/24  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
